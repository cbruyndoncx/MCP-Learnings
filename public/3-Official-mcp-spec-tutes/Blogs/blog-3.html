<!DOCTYPE html>
<html lang="en"><head><title>Blog 3: The Handshake - MCP Lifecycle and Capability Negotiationsourced from github AbhijitKumarJ/MCP-Learnings</title><meta charset="utf-8"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Schibsted Grotesk:wght@400;700&amp;family=Source Sans Pro:ital,wght@0,400;0,600;1,400;1,600&amp;family=IBM Plex Mono:wght@400;600&amp;display=swap"/><link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin="anonymous"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="og:site_name" content="MCP Learnings"/><meta property="og:title" content="Blog 3: The Handshake - MCP Lifecycle and Capability Negotiationsourced from github AbhijitKumarJ/MCP-Learnings"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Blog 3: The Handshake - MCP Lifecycle and Capability Negotiationsourced from github AbhijitKumarJ/MCP-Learnings"/><meta name="twitter:description" content="Blog 3: The Handshake - MCP Lifecycle and Capability Negotiation Series: Deep Dive into the Model Context Protocol SDKs Post: 3 of 12 (Advanced Topics) Before any meaningful exchange of Tools, Resources, or Prompts can occur in the Model Context Protocol (MCP), the client and server must perform a c..."/><meta property="og:description" content="Blog 3: The Handshake - MCP Lifecycle and Capability Negotiation Series: Deep Dive into the Model Context Protocol SDKs Post: 3 of 12 (Advanced Topics) Before any meaningful exchange of Tools, Resources, or Prompts can occur in the Model Context Protocol (MCP), the client and server must perform a c..."/><meta property="og:image:alt" content="Blog 3: The Handshake - MCP Lifecycle and Capability Negotiation Series: Deep Dive into the Model Context Protocol SDKs Post: 3 of 12 (Advanced Topics) Before any meaningful exchange of Tools, Resources, or Prompts can occur in the Model Context Protocol (MCP), the client and server must perform a c..."/><meta property="twitter:domain" content="quartz.jzhao.xyz"/><meta property="og:url" content="https://quartz.jzhao.xyz/3-Official-mcp-spec-tutes/Blogs/blog-3"/><meta property="twitter:url" content="https://quartz.jzhao.xyz/3-Official-mcp-spec-tutes/Blogs/blog-3"/><link rel="icon" href="../../static/icon.png"/><meta name="description" content="Blog 3: The Handshake - MCP Lifecycle and Capability Negotiation Series: Deep Dive into the Model Context Protocol SDKs Post: 3 of 12 (Advanced Topics) Before any meaningful exchange of Tools, Resources, or Prompts can occur in the Model Context Protocol (MCP), the client and server must perform a c..."/><meta name="generator" content="Quartz"/><link href="../../index.css" rel="stylesheet" type="text/css" spa-preserve/><style>.expand-button {
  position: absolute;
  display: flex;
  float: right;
  padding: 0.4rem;
  margin: 0.3rem;
  right: 0;
  color: var(--gray);
  border-color: var(--dark);
  background-color: var(--light);
  border: 1px solid;
  border-radius: 5px;
  opacity: 0;
  transition: 0.2s;
}
.expand-button > svg {
  fill: var(--light);
  filter: contrast(0.3);
}
.expand-button:hover {
  cursor: pointer;
  border-color: var(--secondary);
}
.expand-button:focus {
  outline: 0;
}

pre:hover > .expand-button {
  opacity: 1;
  transition: 0.2s;
}

#mermaid-container {
  position: fixed;
  contain: layout;
  z-index: 999;
  left: 0;
  top: 0;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
  display: none;
  backdrop-filter: blur(4px);
  background: rgba(0, 0, 0, 0.5);
}
#mermaid-container.active {
  display: inline-block;
}
#mermaid-container > #mermaid-space {
  border: 1px solid var(--lightgray);
  background-color: var(--light);
  border-radius: 5px;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  height: 80vh;
  width: 80vw;
  overflow: hidden;
}
#mermaid-container > #mermaid-space > .mermaid-content {
  padding: 2rem;
  position: relative;
  transform-origin: 0 0;
  transition: transform 0.1s ease;
  overflow: visible;
  min-height: 200px;
  min-width: 200px;
}
#mermaid-container > #mermaid-space > .mermaid-content pre {
  margin: 0;
  border: none;
}
#mermaid-container > #mermaid-space > .mermaid-content svg {
  max-width: none;
  height: auto;
}
#mermaid-container > #mermaid-space > .mermaid-controls {
  position: absolute;
  bottom: 20px;
  right: 20px;
  display: flex;
  gap: 8px;
  padding: 8px;
  background: var(--light);
  border: 1px solid var(--lightgray);
  border-radius: 6px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  z-index: 2;
}
#mermaid-container > #mermaid-space > .mermaid-controls .mermaid-control-button {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  padding: 0;
  border: 1px solid var(--lightgray);
  background: var(--light);
  color: var(--dark);
  border-radius: 4px;
  cursor: pointer;
  font-size: 16px;
  font-family: var(--bodyFont);
  transition: all 0.2s ease;
}
#mermaid-container > #mermaid-space > .mermaid-controls .mermaid-control-button:hover {
  background: var(--lightgray);
}
#mermaid-container > #mermaid-space > .mermaid-controls .mermaid-control-button:active {
  transform: translateY(1px);
}
#mermaid-container > #mermaid-space > .mermaid-controls .mermaid-control-button:nth-child(2) {
  width: auto;
  padding: 0 12px;
  font-size: 14px;
}
/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VSb290IjoiL2hvbWUvY2IvcHJvamVjdHMvd3d3L01DUC1MZWFybmluZ3MvcXVhcnR6L2NvbXBvbmVudHMvc3R5bGVzIiwic291cmNlcyI6WyJtZXJtYWlkLmlubGluZS5zY3NzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0VBQ0U7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7O0FBRUE7RUFDRTtFQUNBOztBQUdGO0VBQ0U7RUFDQTs7QUFHRjtFQUNFOzs7QUFLRjtFQUNFO0VBQ0E7OztBQUlKO0VBQ0U7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTs7QUFFQTtFQUNFOztBQUdGO0VBQ0U7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7O0FBRUE7RUFDRTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTs7QUFFQTtFQUNFO0VBQ0E7O0FBR0Y7RUFDRTtFQUNBOztBQUlKO0VBQ0U7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTs7QUFFQTtFQUNFO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7O0FBRUE7RUFDRTs7QUFHRjtFQUNFOztBQUlGO0VBQ0U7RUFDQTtFQUNBIiwic291cmNlc0NvbnRlbnQiOlsiLmV4cGFuZC1idXR0b24ge1xuICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gIGRpc3BsYXk6IGZsZXg7XG4gIGZsb2F0OiByaWdodDtcbiAgcGFkZGluZzogMC40cmVtO1xuICBtYXJnaW46IDAuM3JlbTtcbiAgcmlnaHQ6IDA7IC8vIE5PVEU6IHJpZ2h0IHdpbGwgYmUgc2V0IGluIG1lcm1haWQuaW5saW5lLnRzXG4gIGNvbG9yOiB2YXIoLS1ncmF5KTtcbiAgYm9yZGVyLWNvbG9yOiB2YXIoLS1kYXJrKTtcbiAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tbGlnaHQpO1xuICBib3JkZXI6IDFweCBzb2xpZDtcbiAgYm9yZGVyLXJhZGl1czogNXB4O1xuICBvcGFjaXR5OiAwO1xuICB0cmFuc2l0aW9uOiAwLjJzO1xuXG4gICYgPiBzdmcge1xuICAgIGZpbGw6IHZhcigtLWxpZ2h0KTtcbiAgICBmaWx0ZXI6IGNvbnRyYXN0KDAuMyk7XG4gIH1cblxuICAmOmhvdmVyIHtcbiAgICBjdXJzb3I6IHBvaW50ZXI7XG4gICAgYm9yZGVyLWNvbG9yOiB2YXIoLS1zZWNvbmRhcnkpO1xuICB9XG5cbiAgJjpmb2N1cyB7XG4gICAgb3V0bGluZTogMDtcbiAgfVxufVxuXG5wcmUge1xuICAmOmhvdmVyID4gLmV4cGFuZC1idXR0b24ge1xuICAgIG9wYWNpdHk6IDE7XG4gICAgdHJhbnNpdGlvbjogMC4ycztcbiAgfVxufVxuXG4jbWVybWFpZC1jb250YWluZXIge1xuICBwb3NpdGlvbjogZml4ZWQ7XG4gIGNvbnRhaW46IGxheW91dDtcbiAgei1pbmRleDogOTk5O1xuICBsZWZ0OiAwO1xuICB0b3A6IDA7XG4gIHdpZHRoOiAxMDB2dztcbiAgaGVpZ2h0OiAxMDB2aDtcbiAgb3ZlcmZsb3c6IGhpZGRlbjtcbiAgZGlzcGxheTogbm9uZTtcbiAgYmFja2Ryb3AtZmlsdGVyOiBibHVyKDRweCk7XG4gIGJhY2tncm91bmQ6IHJnYmEoMCwgMCwgMCwgMC41KTtcblxuICAmLmFjdGl2ZSB7XG4gICAgZGlzcGxheTogaW5saW5lLWJsb2NrO1xuICB9XG5cbiAgJiA+ICNtZXJtYWlkLXNwYWNlIHtcbiAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1saWdodGdyYXkpO1xuICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLWxpZ2h0KTtcbiAgICBib3JkZXItcmFkaXVzOiA1cHg7XG4gICAgcG9zaXRpb246IGZpeGVkO1xuICAgIHRvcDogNTAlO1xuICAgIGxlZnQ6IDUwJTtcbiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtNTAlLCAtNTAlKTtcbiAgICBoZWlnaHQ6IDgwdmg7XG4gICAgd2lkdGg6IDgwdnc7XG4gICAgb3ZlcmZsb3c6IGhpZGRlbjtcblxuICAgICYgPiAubWVybWFpZC1jb250ZW50IHtcbiAgICAgIHBhZGRpbmc6IDJyZW07XG4gICAgICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gICAgICB0cmFuc2Zvcm0tb3JpZ2luOiAwIDA7XG4gICAgICB0cmFuc2l0aW9uOiB0cmFuc2Zvcm0gMC4xcyBlYXNlO1xuICAgICAgb3ZlcmZsb3c6IHZpc2libGU7XG4gICAgICBtaW4taGVpZ2h0OiAyMDBweDtcbiAgICAgIG1pbi13aWR0aDogMjAwcHg7XG5cbiAgICAgIHByZSB7XG4gICAgICAgIG1hcmdpbjogMDtcbiAgICAgICAgYm9yZGVyOiBub25lO1xuICAgICAgfVxuXG4gICAgICBzdmcge1xuICAgICAgICBtYXgtd2lkdGg6IG5vbmU7XG4gICAgICAgIGhlaWdodDogYXV0bztcbiAgICAgIH1cbiAgICB9XG5cbiAgICAmID4gLm1lcm1haWQtY29udHJvbHMge1xuICAgICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgICAgYm90dG9tOiAyMHB4O1xuICAgICAgcmlnaHQ6IDIwcHg7XG4gICAgICBkaXNwbGF5OiBmbGV4O1xuICAgICAgZ2FwOiA4cHg7XG4gICAgICBwYWRkaW5nOiA4cHg7XG4gICAgICBiYWNrZ3JvdW5kOiB2YXIoLS1saWdodCk7XG4gICAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1saWdodGdyYXkpO1xuICAgICAgYm9yZGVyLXJhZGl1czogNnB4O1xuICAgICAgYm94LXNoYWRvdzogMCAycHggNHB4IHJnYmEoMCwgMCwgMCwgMC4xKTtcbiAgICAgIHotaW5kZXg6IDI7XG5cbiAgICAgIC5tZXJtYWlkLWNvbnRyb2wtYnV0dG9uIHtcbiAgICAgICAgZGlzcGxheTogZmxleDtcbiAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbiAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7XG4gICAgICAgIHdpZHRoOiAzMnB4O1xuICAgICAgICBoZWlnaHQ6IDMycHg7XG4gICAgICAgIHBhZGRpbmc6IDA7XG4gICAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWxpZ2h0Z3JheSk7XG4gICAgICAgIGJhY2tncm91bmQ6IHZhcigtLWxpZ2h0KTtcbiAgICAgICAgY29sb3I6IHZhcigtLWRhcmspO1xuICAgICAgICBib3JkZXItcmFkaXVzOiA0cHg7XG4gICAgICAgIGN1cnNvcjogcG9pbnRlcjtcbiAgICAgICAgZm9udC1zaXplOiAxNnB4O1xuICAgICAgICBmb250LWZhbWlseTogdmFyKC0tYm9keUZvbnQpO1xuICAgICAgICB0cmFuc2l0aW9uOiBhbGwgMC4ycyBlYXNlO1xuXG4gICAgICAgICY6aG92ZXIge1xuICAgICAgICAgIGJhY2tncm91bmQ6IHZhcigtLWxpZ2h0Z3JheSk7XG4gICAgICAgIH1cblxuICAgICAgICAmOmFjdGl2ZSB7XG4gICAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKDFweCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBTdHlsZSB0aGUgcmVzZXQgYnV0dG9uIGRpZmZlcmVudGx5XG4gICAgICAgICY6bnRoLWNoaWxkKDIpIHtcbiAgICAgICAgICB3aWR0aDogYXV0bztcbiAgICAgICAgICBwYWRkaW5nOiAwIDEycHg7XG4gICAgICAgICAgZm9udC1zaXplOiAxNHB4O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG59XG4iXX0= */</style><script src="../../prescript.js" type="application/javascript" spa-preserve></script><script type="application/javascript" spa-preserve>const fetchData = fetch("../../static/contentIndex.json").then(data => data.json())</script><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="https://quartz.jzhao.xyz/index.xml"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="630"/><meta property="og:image" content="https://quartz.jzhao.xyz/3-Official-mcp-spec-tutes/Blogs/blog-3-og-image.webp"/><meta property="og:image:url" content="https://quartz.jzhao.xyz/3-Official-mcp-spec-tutes/Blogs/blog-3-og-image.webp"/><meta name="twitter:image" content="https://quartz.jzhao.xyz/3-Official-mcp-spec-tutes/Blogs/blog-3-og-image.webp"/><meta property="og:image:type" content="image/.webp"/></head><body data-slug="3-Official-mcp-spec-tutes/Blogs/blog-3"><div id="quartz-root" class="page"><div id="quartz-body"><div class="left sidebar"><h2 class="page-title"><a href="../..">MCP Learnings</a></h2><div class="spacer mobile-only"></div><div style="display: flex; flex-direction: row; flex-wrap: nowrap; gap: 1rem;"><div style="flex-grow: 1; flex-shrink: 1; flex-basis: auto; order: 0; align-self: center; justify-self: center;"><div class="search"><button class="search-button"><p>Search</p><svg role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title>Search</title><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"></path><circle cx="8" cy="8" r="7"></circle></g></svg></button><div class="search-container"><div class="search-space"><input autocomplete="off" class="search-bar" name="search" type="text" aria-label="Search for something" placeholder="Search for something"/><div class="search-layout" data-preview="true"></div></div></div></div></div><div style="flex-grow: 0; flex-shrink: 1; flex-basis: auto; order: 0; align-self: center; justify-self: center;"><button class="darkmode"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" class="dayIcon" x="0px" y="0px" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35" xml:space="preserve" aria-label="Dark mode"><title>Dark mode</title><path d="M6,17.5C6,16.672,5.328,16,4.5,16h-3C0.672,16,0,16.672,0,17.5    S0.672,19,1.5,19h3C5.328,19,6,18.328,6,17.5z M7.5,26c-0.414,0-0.789,0.168-1.061,0.439l-2,2C4.168,28.711,4,29.086,4,29.5    C4,30.328,4.671,31,5.5,31c0.414,0,0.789-0.168,1.06-0.44l2-2C8.832,28.289,9,27.914,9,27.5C9,26.672,8.329,26,7.5,26z M17.5,6    C18.329,6,19,5.328,19,4.5v-3C19,0.672,18.329,0,17.5,0S16,0.672,16,1.5v3C16,5.328,16.671,6,17.5,6z M27.5,9    c0.414,0,0.789-0.168,1.06-0.439l2-2C30.832,6.289,31,5.914,31,5.5C31,4.672,30.329,4,29.5,4c-0.414,0-0.789,0.168-1.061,0.44    l-2,2C26.168,6.711,26,7.086,26,7.5C26,8.328,26.671,9,27.5,9z M6.439,8.561C6.711,8.832,7.086,9,7.5,9C8.328,9,9,8.328,9,7.5    c0-0.414-0.168-0.789-0.439-1.061l-2-2C6.289,4.168,5.914,4,5.5,4C4.672,4,4,4.672,4,5.5c0,0.414,0.168,0.789,0.439,1.06    L6.439,8.561z M33.5,16h-3c-0.828,0-1.5,0.672-1.5,1.5s0.672,1.5,1.5,1.5h3c0.828,0,1.5-0.672,1.5-1.5S34.328,16,33.5,16z     M28.561,26.439C28.289,26.168,27.914,26,27.5,26c-0.828,0-1.5,0.672-1.5,1.5c0,0.414,0.168,0.789,0.439,1.06l2,2    C28.711,30.832,29.086,31,29.5,31c0.828,0,1.5-0.672,1.5-1.5c0-0.414-0.168-0.789-0.439-1.061L28.561,26.439z M17.5,29    c-0.829,0-1.5,0.672-1.5,1.5v3c0,0.828,0.671,1.5,1.5,1.5s1.5-0.672,1.5-1.5v-3C19,29.672,18.329,29,17.5,29z M17.5,7    C11.71,7,7,11.71,7,17.5S11.71,28,17.5,28S28,23.29,28,17.5S23.29,7,17.5,7z M17.5,25c-4.136,0-7.5-3.364-7.5-7.5    c0-4.136,3.364-7.5,7.5-7.5c4.136,0,7.5,3.364,7.5,7.5C25,21.636,21.636,25,17.5,25z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" class="nightIcon" x="0px" y="0px" viewBox="0 0 100 100" style="enable-background:new 0 0 100 100" xml:space="preserve" aria-label="Light mode"><title>Light mode</title><path d="M96.76,66.458c-0.853-0.852-2.15-1.064-3.23-0.534c-6.063,2.991-12.858,4.571-19.655,4.571  C62.022,70.495,50.88,65.88,42.5,57.5C29.043,44.043,25.658,23.536,34.076,6.47c0.532-1.08,0.318-2.379-0.534-3.23  c-0.851-0.852-2.15-1.064-3.23-0.534c-4.918,2.427-9.375,5.619-13.246,9.491c-9.447,9.447-14.65,22.008-14.65,35.369  c0,13.36,5.203,25.921,14.65,35.368s22.008,14.65,35.368,14.65c13.361,0,25.921-5.203,35.369-14.65  c3.872-3.871,7.064-8.328,9.491-13.246C97.826,68.608,97.611,67.309,96.76,66.458z"></path></svg></button></div><div style="flex-grow: 0; flex-shrink: 1; flex-basis: auto; order: 0; align-self: center; justify-self: center;"><button class="readermode"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" class="readerIcon" fill="currentColor" stroke="currentColor" stroke-width="0.2" stroke-linecap="round" stroke-linejoin="round" width="64px" height="64px" viewBox="0 0 24 24" aria-label="Reader mode"><title>Reader mode</title><g transform="translate(-1.8, -1.8) scale(1.15, 1.2)"><path d="M8.9891247,2.5 C10.1384702,2.5 11.2209868,2.96705384 12.0049645,3.76669482 C12.7883914,2.96705384 13.8709081,2.5 15.0202536,2.5 L18.7549359,2.5 C19.1691495,2.5 19.5049359,2.83578644 19.5049359,3.25 L19.5046891,4.004 L21.2546891,4.00457396 C21.6343849,4.00457396 21.9481801,4.28672784 21.9978425,4.6528034 L22.0046891,4.75457396 L22.0046891,20.25 C22.0046891,20.6296958 21.7225353,20.943491 21.3564597,20.9931534 L21.2546891,21 L2.75468914,21 C2.37499337,21 2.06119817,20.7178461 2.01153575,20.3517706 L2.00468914,20.25 L2.00468914,4.75457396 C2.00468914,4.37487819 2.28684302,4.061083 2.65291858,4.01142057 L2.75468914,4.00457396 L4.50368914,4.004 L4.50444233,3.25 C4.50444233,2.87030423 4.78659621,2.55650904 5.15267177,2.50684662 L5.25444233,2.5 L8.9891247,2.5 Z M4.50368914,5.504 L3.50468914,5.504 L3.50468914,19.5 L10.9478955,19.4998273 C10.4513189,18.9207296 9.73864328,18.5588115 8.96709342,18.5065584 L8.77307039,18.5 L5.25444233,18.5 C4.87474657,18.5 4.56095137,18.2178461 4.51128895,17.8517706 L4.50444233,17.75 L4.50368914,5.504 Z M19.5049359,17.75 C19.5049359,18.1642136 19.1691495,18.5 18.7549359,18.5 L15.2363079,18.5 C14.3910149,18.5 13.5994408,18.8724714 13.0614828,19.4998273 L20.5046891,19.5 L20.5046891,5.504 L19.5046891,5.504 L19.5049359,17.75 Z M18.0059359,3.999 L15.0202536,4 L14.8259077,4.00692283 C13.9889509,4.06666544 13.2254227,4.50975805 12.7549359,5.212 L12.7549359,17.777 L12.7782651,17.7601316 C13.4923805,17.2719483 14.3447024,17 15.2363079,17 L18.0059359,16.999 L18.0056891,4.798 L18.0033792,4.75457396 L18.0056891,4.71 L18.0059359,3.999 Z M8.9891247,4 L6.00368914,3.999 L6.00599909,4.75457396 L6.00599909,4.75457396 L6.00368914,4.783 L6.00368914,16.999 L8.77307039,17 C9.57551536,17 10.3461406,17.2202781 11.0128313,17.6202194 L11.2536891,17.776 L11.2536891,5.211 C10.8200889,4.56369974 10.1361548,4.13636104 9.37521067,4.02745763 L9.18347055,4.00692283 L8.9891247,4 Z"></path></g></svg></button></div></div><div class="explorer" data-behavior="link" data-collapsed="collapsed" data-savestate="true" data-data-fns="{&quot;order&quot;:[&quot;filter&quot;,&quot;map&quot;,&quot;sort&quot;],&quot;sortFn&quot;:&quot;(a,b)=>!a.isFolder&amp;&amp;!b.isFolder||a.isFolder&amp;&amp;b.isFolder?a.displayName.localeCompare(b.displayName,void 0,{numeric:!0,sensitivity:\&quot;base\&quot;}):!a.isFolder&amp;&amp;b.isFolder?1:-1&quot;,&quot;filterFn&quot;:&quot;node=>node.slugSegment!==\&quot;tags\&quot;&quot;,&quot;mapFn&quot;:&quot;node=>node&quot;}"><button type="button" class="explorer-toggle mobile-explorer hide-until-loaded" data-mobile="true" aria-controls="explorer-content"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide-menu"><line x1="4" x2="20" y1="12" y2="12"></line><line x1="4" x2="20" y1="6" y2="6"></line><line x1="4" x2="20" y1="18" y2="18"></line></svg></button><button type="button" class="title-button explorer-toggle desktop-explorer" data-mobile="false" aria-expanded="true"><h2>Explorer</h2><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><div class="explorer-content" aria-expanded="false"><ul class="explorer-ul overflow" id="list-0"><li class="overflow-end"></li></ul></div><template id="template-file"><li><a href="#"></a></li></template><template id="template-folder"><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div><button class="folder-button"><span class="folder-title"></span></button></div></div><div class="folder-outer"><ul class="content"></ul></div></li></template></div></div><div class="center"><div class="page-header"><div class="popover-hint"><nav class="breadcrumb-container" aria-label="breadcrumbs"><div class="breadcrumb-element"><a href="../../">Home</a><p> ❯ </p></div><div class="breadcrumb-element"><a href="../../3-Official-mcp-spec-tutes/">3 Official mcp spec tutes</a><p> ❯ </p></div><div class="breadcrumb-element"><a href="../../3-Official-mcp-spec-tutes/Blogs/">Blogs</a><p> ❯ </p></div><div class="breadcrumb-element"><a href>Blog 3: The Handshake   MCP Lifecycle and Capability Negotiation</a></div></nav><h1 class="article-title">Blog 3: The Handshake - MCP Lifecycle and Capability Negotiation</h1><p show-comma="true" class="content-meta"><time datetime="2025-05-08T20:34:18.000Z">May 08, 2025</time><span>8 min read</span></p></div></div><article class="popover-hint"><h2 id="blog-3-the-handshake---mcp-lifecycle-and-capability-negotiation">Blog 3: The Handshake - MCP Lifecycle and Capability Negotiation<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#blog-3-the-handshake---mcp-lifecycle-and-capability-negotiation" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p><strong>Series:</strong> Deep Dive into the Model Context Protocol SDKs
<strong>Post:</strong> 3 of 12 (Advanced Topics)</p>
<p>Before any meaningful exchange of Tools, Resources, or Prompts can occur in the Model Context Protocol (MCP), the client and server must perform a crucial <strong>initialization handshake</strong>. This isn’t just about establishing a connection; it’s a formal negotiation defined by the <a href="https://modelcontextprotocol.io/specification/draft/basic/lifecycle/" class="external">MCP specification<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a> to ensure both parties speak the same protocol version and understand each other’s capabilities.</p>
<p>This post dissects the <code>initialize</code> / <code>initialized</code> flow, focusing on how the TypeScript, Python, C#, and Java SDKs implement this critical lifecycle phase and manage the crucial <strong>Capability Negotiation</strong>. Understanding this handshake is vital for debugging connection issues, ensuring compatibility, and controlling the features available during an MCP session.</p>
<h3 id="the-initialization-sequence-mcp-spec-recap">The Initialization Sequence (MCP Spec Recap)<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#the-initialization-sequence-mcp-spec-recap" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<ol>
<li>
<p><strong>Client <span>→</span> Server: <code>initialize</code> Request:</strong></p>
<ul>
<li>The <em>first</em> message sent by the client after the transport connection is established.</li>
<li><strong>MUST</strong> contain:
<ul>
<li><code>protocolVersion</code>: The <em>latest</em> MCP spec version the client supports (e.g., <code>&quot;2025-03-26&quot;</code>).</li>
<li><code>clientInfo</code>: An <code>Implementation</code> object (<code>{ name: string, version: string }</code>).</li>
<li><code>capabilities</code>: A <code>ClientCapabilities</code> object declaring what the client can do (e.g., handle <code>sampling/createMessage</code>, process <code>roots/list_changed</code> notifications).</li>
</ul>
</li>
<li><strong>MUST NOT</strong> be part of a JSON-RPC batch.</li>
</ul>
</li>
<li>
<p><strong>Server <span>→</span> Client: <code>initialize</code> Response (Result or Error):</strong></p>
<ul>
<li><strong>On Success (<code>result</code>):</strong>
<ul>
<li><code>protocolVersion</code>: The version the server <em>chooses</em> to use for this session. This <strong>MUST</strong> be a version the server supports and <strong>SHOULD</strong> be the version the client requested if possible, otherwise the latest version the server <em>does</em> support.</li>
<li><code>serverInfo</code>: The server’s <code>Implementation</code> object.</li>
<li><code>capabilities</code>: A <code>ServerCapabilities</code> object declaring what the <em>server</em> can do (e.g., supports <code>tools</code>, <code>resources</code> with <code>subscribe</code>, <code>prompts</code> with <code>listChanged</code>, <code>logging</code>).</li>
<li><code>instructions</code> (Optional): Human-readable hints for using the server.</li>
</ul>
</li>
<li><strong>On Error (<code>error</code>):</strong> If the server cannot proceed (e.g., unsupported client <code>protocolVersion</code>, invalid request), it sends a standard JSON-RPC error response.</li>
</ul>
</li>
<li>
<p><strong>Client Validation:</strong> The client receives the <code>initialize</code> response.</p>
<ul>
<li>It <strong>MUST</strong> check if it supports the <code>protocolVersion</code> chosen by the server. If not, it <strong>SHOULD</strong> disconnect.</li>
<li>It stores the server’s <code>capabilities</code> and <code>serverInfo</code>.</li>
</ul>
</li>
<li>
<p><strong>Client <span>→</span> Server: <code>initialized</code> Notification:</strong></p>
<ul>
<li>If the client accepts the server’s response, it sends this parameter-less notification.</li>
<li>Signals that the client is ready for normal operation using the negotiated version and capabilities.</li>
</ul>
</li>
<li>
<p><strong>Session Active:</strong> Both sides can now send any requests/notifications allowed by the negotiated capabilities.</p>
</li>
</ol>
<h3 id="sdk-implementations-of-the-handshake">SDK Implementations of the Handshake<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#sdk-implementations-of-the-handshake" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>How do the SDKs orchestrate this dance?</p>
<p><strong>1. TypeScript (<code>Client.connect</code> / <code>Server</code> handler):</strong></p>
<ul>
<li><strong>Client (<code>Client.connect</code>):</strong>
<ul>
<li>Called <em>after</em> <code>new Client(...)</code>.</li>
<li>Takes a <code>Transport</code> instance.</li>
<li>Internally calls <code>transport.start()</code>.</li>
<li><em>Automatically</em> sends the <code>initialize</code> request using <code>ClientInfo</code> and <code>Capabilities</code> provided during <code>Client</code> construction (or defaults).</li>
<li>Waits for the server’s response using the core <code>Protocol.request</code> logic.</li>
<li><em>Validates</em> the returned <code>protocolVersion</code> against <code>SUPPORTED_PROTOCOL_VERSIONS</code>. Throws an error and closes the transport if incompatible.</li>
<li>Stores <code>serverInfo</code>, <code>serverCapabilities</code>, <code>serverInstructions</code> on the <code>Client</code> instance.</li>
<li><em>Automatically</em> sends the <code>initialized</code> notification.</li>
<li>Resolves the <code>connect</code> promise upon successful completion.</li>
</ul>
</li>
<li><strong>Server (<code>Server</code> internal handler):</strong>
<ul>
<li>The low-level <code>Server</code> has a built-in handler for the <code>initialize</code> method (registered in its constructor).</li>
<li>This handler (<code>_oninitialize</code> in <code>src/server/index.ts</code>) receives the <code>InitializeRequest</code>.</li>
<li>It stores the <code>clientInfo</code> and <code>clientCapabilities</code> on the <code>Server</code> instance.</li>
<li>It determines the best compatible <code>protocolVersion</code> to use.</li>
<li>It constructs the <code>InitializeResult</code> using its own <code>ServerInfo</code> and <code>Capabilities</code> (provided during <code>Server</code> construction or via <code>McpServer</code> configuration).</li>
<li>The core <code>Protocol</code> layer sends the response back.</li>
<li>It also has a handler for <code>initialized</code> notification which triggers the optional <code>oninitialized</code> callback.</li>
</ul>
</li>
</ul>
<p><strong>2. Python (<code>ClientSession.__aenter__</code> / <code>ServerSession</code> handler):</strong></p>
<ul>
<li><strong>Client (<code>ClientSession.__aenter__</code> / <code>initialize()</code>):</strong>
<ul>
<li>The <code>async with ClientSession(...)</code> context manager automatically calls <code>session.initialize()</code> upon entering the block.</li>
<li><code>initialize()</code> sends the <code>initialize</code> request using <code>client_info</code> and capabilities derived from constructor arguments (e.g., presence of <code>sampling_callback</code>).</li>
<li>It waits for the response, validates the <code>protocolVersion</code> against <code>SUPPORTED_PROTOCOL_VERSIONS</code>, raises <code>RuntimeError</code> on mismatch.</li>
<li>Stores server info/capabilities internally (less explicitly exposed via properties than TS client).</li>
<li>Sends the <code>initialized</code> notification.</li>
<li>Returns the <code>InitializeResult</code> object.</li>
</ul>
</li>
<li><strong>Server (<code>ServerSession</code> internal handler):</strong>
<ul>
<li>The internal <code>_received_request</code> method within <code>ServerSession</code> specifically checks if the request method is <code>initialize</code>.</li>
<li>If it is, it marks the session state as <code>Initializing</code>, stores the <code>client_params</code> (including capabilities and info), and constructs the <code>InitializeResult</code> based on the <code>InitializationOptions</code> passed when the <code>ServerSession</code> was created by the <code>Server</code>.</li>
<li>It sends the response.</li>
<li>The internal <code>_received_notification</code> method checks for <code>InitializedNotification</code> and updates the session state to <code>Initialized</code>, allowing subsequent requests/notifications.</li>
</ul>
</li>
</ul>
<p><strong>3. C# (<code>McpClientFactory.CreateAsync</code> / <code>McpServer</code> handler):</strong></p>
<ul>
<li><strong>Client (<code>McpClientFactory.CreateAsync</code>):</strong>
<ul>
<li>This factory method orchestrates the entire connection and initialization.</li>
<li>It takes an <code>IClientTransport</code>.</li>
<li>Calls <code>transport.ConnectAsync()</code> to get an <code>ITransport</code>.</li>
<li>Creates the internal <code>McpClient</code>/<code>McpSession</code>.</li>
<li><em>Automatically</em> sends the <code>initialize</code> request using <code>McpClientOptions</code> (passed to the factory).</li>
<li>Waits for the response, validates <code>protocolVersion</code>. Throws <code>McpException</code> or <code>TimeoutException</code>.</li>
<li>Stores server details (<code>ServerInfo</code>, <code>ServerCapabilities</code>, <code>ServerInstructions</code>) on the <code>IMcpClient</code> instance.</li>
<li><em>Automatically</em> sends the <code>initialized</code> notification.</li>
<li>Returns the fully connected and initialized <code>IMcpClient</code>.</li>
</ul>
</li>
<li><strong>Server (<code>McpServer</code> internal handler):</strong>
<ul>
<li>Similar to TS, the internal <code>McpServer</code> sets up a handler for <code>initialize</code> (<code>SetInitializeHandler</code>).</li>
<li>Receives the request, stores client info/caps.</li>
<li>Determines response <code>protocolVersion</code>.</li>
<li>Constructs <code>InitializeResult</code> using configured <code>McpServerOptions</code> (often populated via DI builder extensions).</li>
<li>Sends the response.</li>
<li>Handles <code>initialized</code> notification internally.</li>
</ul>
</li>
</ul>
<p><strong>4. Java (<code>client.initialize()</code> / <code>McpServerSession</code> handler):</strong></p>
<ul>
<li><strong>Client (<code>McpAsync/SyncClient.initialize()</code>):</strong>
<ul>
<li><em>Explicitly</em> called by the developer <em>after</em> the client object is built (<code>McpClient.async/sync(...).build()</code>).</li>
<li>Sends the <code>initialize</code> request using <code>clientInfo</code> and <code>capabilities</code> configured via the builder.</li>
<li>Waits for the response (blocking in Sync, returning <code>Mono&lt;InitializeResult></code> in Async).</li>
<li>Validates <code>protocolVersion</code>. Throws <code>McpError</code> on mismatch or other errors.</li>
<li>Stores server details internally.</li>
<li>Sends the <code>initialized</code> notification.</li>
<li>Returns the <code>InitializeResult</code> object.</li>
</ul>
</li>
<li><strong>Server (<code>McpServerSession</code> internal handler):</strong>
<ul>
<li>The <code>handle(JSONRPCMessage)</code> method within <code>McpServerSession</code> checks for <code>InitializeRequest</code>.</li>
<li>It performs state checks (must be first request), stores <code>clientCapabilities</code>/<code>clientInfo</code>, validates version, constructs <code>InitializeResult</code> based on the <code>McpServerFeatures</code> it was created with, and sends the response via its dedicated <code>McpServerTransport</code>.</li>
<li>It also handles the <code>InitializedNotification</code> to transition its internal state.</li>
</ul>
</li>
</ul>
<h3 id="capability-negotiation-in-practice">Capability Negotiation in Practice<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#capability-negotiation-in-practice" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>The <code>capabilities</code> objects exchanged during initialization are crucial dictionaries telling each side what the <em>other</em> side supports.</p>
<ul>
<li><strong>Client Declares:</strong> Support for <code>sampling</code>, <code>roots</code> (and <code>roots.listChanged</code>).</li>
<li><strong>Server Declares:</strong> Support for <code>tools</code>, <code>resources</code>, <code>prompts</code> (and their respective <code>listChanged</code> flags), <code>resources.subscribe</code>, <code>logging</code>, <code>completions</code> (newer specs).</li>
</ul>
<p><strong>How SDKs Use Negotiated Capabilities:</strong></p>
<ul>
<li><strong>Client-Side Checks:</strong> Before sending a request like <code>tools/call</code>, a well-behaved client SDK <em>should</em> check if the stored <code>serverCapabilities</code> actually includes <code>tools</code>.
<ul>
<li><em>TS/Python:</em> The <code>enforceStrictCapabilities</code> option controls whether the base <code>Protocol</code>/<code>BaseSession</code> throws an error if a capability is missing on the <em>server</em> side before sending.</li>
<li><em>C#/Java:</em> This check seems less explicit in the core client methods; developers might need to check <code>client.ServerCapabilities</code> manually before calling certain methods if strict adherence is required.</li>
</ul>
</li>
<li><strong>Server-Side Checks:</strong> Before sending a request like <code>sampling/createMessage</code>, the server SDK <em>should</em> check if the stored <code>clientCapabilities</code> includes <code>sampling</code>.
<ul>
<li><em>TS/Python:</em> <code>enforceStrictCapabilities</code> also controls checks for missing <em>client</em> capabilities before the server sends a request.</li>
<li><em>C#/Java:</em> The <code>IMcpServer</code> interface includes <code>ClientCapabilities</code> property. Server logic (especially within Tools/Prompts needing sampling or roots) should check this property. <code>McpServerExtensions</code> like <code>AsSamplingChatClient</code> (C#) perform this check internally.</li>
</ul>
</li>
</ul>
<p><strong>Nuance:</strong> While the spec defines capabilities, ensuring SDKs <em>consistently</em> and <em>correctly</em> check them before <em>all</em> relevant operations can be challenging. The <code>enforceStrictCapabilities</code> flag in TS/Python acknowledges that older or simpler implementations might not perfectly advertise or check capabilities, offering a compatibility mode. C#/Java appear to rely more on developers performing explicit checks where needed.</p>
<h3 id="error-handling-during-handshake">Error Handling during Handshake<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#error-handling-during-handshake" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<ul>
<li><strong>Version Mismatch:</strong> Server responds with its version, client disconnects if incompatible.</li>
<li><strong>Invalid Initialize Request:</strong> Server sends <code>JSONRPCError</code> (e.g., code <code>-32600 Invalid Request</code>).</li>
<li><strong>Timeout:</strong> Client or server times out waiting for <code>initialize</code> response or <code>initialized</code> notification (SDKs typically have specific <code>InitializationTimeout</code> settings).</li>
<li><strong>Transport Failure:</strong> Underlying transport fails during handshake (e.g., process fails to start in Stdio, HTTP connection error).</li>
</ul>
<h3 id="conclusion-the-foundation-of-trust">Conclusion: The Foundation of Trust<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#conclusion-the-foundation-of-trust" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<p>The MCP initialization handshake is more than just establishing a connection; it’s a critical negotiation that sets the stage for the entire session. It ensures both client and server agree on the protocol version and are aware of each other’s capabilities.</p>
<p>All four SDKs implement this lifecycle faithfully, albeit with slightly different orchestration:</p>
<ul>
<li><strong>TypeScript and C#</strong> largely automate the handshake within their <code>connect</code>/<code>CreateAsync</code> methods.</li>
<li><strong>Python and Java</strong> require an explicit <code>initialize()</code> call after creating the client session object.</li>
</ul>
<p>Understanding how capabilities are declared (DI/Attributes in C#, Builder/Options in TS/Java/Python) and how they are checked (explicitly by developers or implicitly by the SDK with flags like <code>enforceStrictCapabilities</code>) is vital for advanced users building interoperable and robust MCP applications. This handshake ensures that subsequent interactions only use features that both parties have agreed to support, forming the foundation of trust for the complex operations MCP enables.</p>
<p>Next, we’ll dive back into the server internals, specifically focusing on how requests are dispatched to the correct handlers once the session is active.</p>
<hr/></article><hr/><div class="page-footer"></div></div><div class="right sidebar"><div class="graph"><h3>Graph View</h3><div class="graph-outer"><div class="graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:1,&quot;scale&quot;:1.1,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:false,&quot;enableRadial&quot;:false}"></div><button class="global-graph-icon" aria-label="Global Graph"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 55 55" fill="currentColor" xml:space="preserve"><path d="M49,0c-3.309,0-6,2.691-6,6c0,1.035,0.263,2.009,0.726,2.86l-9.829,9.829C32.542,17.634,30.846,17,29,17
                s-3.542,0.634-4.898,1.688l-7.669-7.669C16.785,10.424,17,9.74,17,9c0-2.206-1.794-4-4-4S9,6.794,9,9s1.794,4,4,4
                c0.74,0,1.424-0.215,2.019-0.567l7.669,7.669C21.634,21.458,21,23.154,21,25s0.634,3.542,1.688,4.897L10.024,42.562
                C8.958,41.595,7.549,41,6,41c-3.309,0-6,2.691-6,6s2.691,6,6,6s6-2.691,6-6c0-1.035-0.263-2.009-0.726-2.86l12.829-12.829
                c1.106,0.86,2.44,1.436,3.898,1.619v10.16c-2.833,0.478-5,2.942-5,5.91c0,3.309,2.691,6,6,6s6-2.691,6-6c0-2.967-2.167-5.431-5-5.91
                v-10.16c1.458-0.183,2.792-0.759,3.898-1.619l7.669,7.669C41.215,39.576,41,40.26,41,41c0,2.206,1.794,4,4,4s4-1.794,4-4
                s-1.794-4-4-4c-0.74,0-1.424,0.215-2.019,0.567l-7.669-7.669C36.366,28.542,37,26.846,37,25s-0.634-3.542-1.688-4.897l9.665-9.665
                C46.042,11.405,47.451,12,49,12c3.309,0,6-2.691,6-6S52.309,0,49,0z M11,9c0-1.103,0.897-2,2-2s2,0.897,2,2s-0.897,2-2,2
                S11,10.103,11,9z M6,51c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S8.206,51,6,51z M33,49c0,2.206-1.794,4-4,4s-4-1.794-4-4
                s1.794-4,4-4S33,46.794,33,49z M29,31c-3.309,0-6-2.691-6-6s2.691-6,6-6s6,2.691,6,6S32.309,31,29,31z M47,41c0,1.103-0.897,2-2,2
                s-2-0.897-2-2s0.897-2,2-2S47,39.897,47,41z M49,10c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S51.206,10,49,10z"></path></svg></button></div><div class="global-graph-outer"><div class="global-graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:-1,&quot;scale&quot;:0.9,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.2,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:true,&quot;enableRadial&quot;:true}"></div></div></div><div class="toc desktop-only"><button type="button" class="toc-header" aria-controls="toc-content" aria-expanded="true"><h3>Table of Contents</h3><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><ul class="toc-content overflow" id="list-1"><li class="depth-0"><a href="#blog-3-the-handshake---mcp-lifecycle-and-capability-negotiation" data-for="blog-3-the-handshake---mcp-lifecycle-and-capability-negotiation">Blog 3: The Handshake - MCP Lifecycle and Capability Negotiation</a></li><li class="depth-1"><a href="#the-initialization-sequence-mcp-spec-recap" data-for="the-initialization-sequence-mcp-spec-recap">The Initialization Sequence (MCP Spec Recap)</a></li><li class="depth-1"><a href="#sdk-implementations-of-the-handshake" data-for="sdk-implementations-of-the-handshake">SDK Implementations of the Handshake</a></li><li class="depth-1"><a href="#capability-negotiation-in-practice" data-for="capability-negotiation-in-practice">Capability Negotiation in Practice</a></li><li class="depth-1"><a href="#error-handling-during-handshake" data-for="error-handling-during-handshake">Error Handling during Handshake</a></li><li class="depth-1"><a href="#conclusion-the-foundation-of-trust" data-for="conclusion-the-foundation-of-trust">Conclusion: The Foundation of Trust</a></li><li class="overflow-end"></li></ul></div><div class="backlinks"><h3>Backlinks</h3><ul id="list-2" class="overflow"><li><a href="../../3-Official-mcp-spec-tutes/Blogs/blog-10" class="internal">Blog 10: The Spec Itself - Evolution, Contribution, and Future Directions in MCP</a></li><li><a href="../../3-Official-mcp-spec-tutes/Blogs/blog-4" class="internal">Blog 4: Exposing Actions - The Tool Primitive: Spec vs. Implementation Across MCP SDKs</a></li><li><a href="../../3-Official-mcp-spec-tutes/Blogs/blog-6" class="internal">Blog 6: Guiding Interactions - The Prompt Primitive Across MCP SDKs</a></li><li><a href="../../3-Official-mcp-spec-tutes/Blogs/blog-7" class="internal">Blog 7: When the Server Asks - Client Capabilities (Sampling &amp; Roots) Across MCP SDKs</a></li><li><a href="../../3-Official-mcp-spec-tutes/Blogs/blog-8" class="internal">Blog 8: Communication Channels - Comparing Transport Implementations Across MCP SDKs</a></li><li class="overflow-end"></li></ul></div></div><footer class><p>Created with <a href="https://quartz.jzhao.xyz/">Quartz v4.5.0</a> © 2025</p><ul><li><a href="https://github.com/jackyzha0/quartz">GitHub</a></li><li><a href="https://discord.gg/cRFFHYye7t">Discord Community</a></li></ul></footer></div></div></body><script type="application/javascript">function n(){let t=this.parentElement;t.classList.toggle("is-collapsed");let e=t.getElementsByClassName("callout-content")[0];if(!e)return;let l=t.classList.contains("is-collapsed");e.style.gridTemplateRows=l?"0fr":"1fr"}function c(){let t=document.getElementsByClassName("callout is-collapsible");for(let e of t){let l=e.getElementsByClassName("callout-title")[0],s=e.getElementsByClassName("callout-content")[0];if(!l||!s)continue;l.addEventListener("click",n),window.addCleanup(()=>l.removeEventListener("click",n));let o=e.classList.contains("is-collapsed");s.style.gridTemplateRows=o?"0fr":"1fr"}}document.addEventListener("nav",c);
</script><script type="module">function f(i,e){if(!i)return;function r(o){o.target===this&&(o.preventDefault(),o.stopPropagation(),e())}function t(o){o.key.startsWith("Esc")&&(o.preventDefault(),e())}i?.addEventListener("click",r),window.addCleanup(()=>i?.removeEventListener("click",r)),document.addEventListener("keydown",t),window.addCleanup(()=>document.removeEventListener("keydown",t))}function y(i){for(;i.firstChild;)i.removeChild(i.firstChild)}var h=class{constructor(e,r){this.container=e;this.content=r;this.setupEventListeners(),this.setupNavigationControls(),this.resetTransform()}isDragging=!1;startPan={x:0,y:0};currentPan={x:0,y:0};scale=1;MIN_SCALE=.5;MAX_SCALE=3;cleanups=[];setupEventListeners(){let e=this.onMouseDown.bind(this),r=this.onMouseMove.bind(this),t=this.onMouseUp.bind(this),o=this.resetTransform.bind(this);this.container.addEventListener("mousedown",e),document.addEventListener("mousemove",r),document.addEventListener("mouseup",t),window.addEventListener("resize",o),this.cleanups.push(()=>this.container.removeEventListener("mousedown",e),()=>document.removeEventListener("mousemove",r),()=>document.removeEventListener("mouseup",t),()=>window.removeEventListener("resize",o))}cleanup(){for(let e of this.cleanups)e()}setupNavigationControls(){let e=document.createElement("div");e.className="mermaid-controls";let r=this.createButton("+",()=>this.zoom(.1)),t=this.createButton("-",()=>this.zoom(-.1)),o=this.createButton("Reset",()=>this.resetTransform());e.appendChild(t),e.appendChild(o),e.appendChild(r),this.container.appendChild(e)}createButton(e,r){let t=document.createElement("button");return t.textContent=e,t.className="mermaid-control-button",t.addEventListener("click",r),window.addCleanup(()=>t.removeEventListener("click",r)),t}onMouseDown(e){e.button===0&&(this.isDragging=!0,this.startPan={x:e.clientX-this.currentPan.x,y:e.clientY-this.currentPan.y},this.container.style.cursor="grabbing")}onMouseMove(e){this.isDragging&&(e.preventDefault(),this.currentPan={x:e.clientX-this.startPan.x,y:e.clientY-this.startPan.y},this.updateTransform())}onMouseUp(){this.isDragging=!1,this.container.style.cursor="grab"}zoom(e){let r=Math.min(Math.max(this.scale+e,this.MIN_SCALE),this.MAX_SCALE),t=this.content.getBoundingClientRect(),o=t.width/2,n=t.height/2,c=r-this.scale;this.currentPan.x-=o*c,this.currentPan.y-=n*c,this.scale=r,this.updateTransform()}updateTransform(){this.content.style.transform=`translate(${this.currentPan.x}px, ${this.currentPan.y}px) scale(${this.scale})`}resetTransform(){this.scale=1;let e=this.content.querySelector("svg");this.currentPan={x:e.getBoundingClientRect().width/2,y:e.getBoundingClientRect().height/2},this.updateTransform()}},C=["--secondary","--tertiary","--gray","--light","--lightgray","--highlight","--dark","--darkgray","--codeFont"],E;document.addEventListener("nav",async()=>{let e=document.querySelector(".center").querySelectorAll("code.mermaid");if(e.length===0)return;E||=await import("https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.4.0/mermaid.esm.min.mjs");let r=E.default,t=new WeakMap;for(let n of e)t.set(n,n.innerText);async function o(){for(let s of e){s.removeAttribute("data-processed");let a=t.get(s);a&&(s.innerHTML=a)}let n=C.reduce((s,a)=>(s[a]=window.getComputedStyle(document.documentElement).getPropertyValue(a),s),{}),c=document.documentElement.getAttribute("saved-theme")==="dark";r.initialize({startOnLoad:!1,securityLevel:"loose",theme:c?"dark":"base",themeVariables:{fontFamily:n["--codeFont"],primaryColor:n["--light"],primaryTextColor:n["--darkgray"],primaryBorderColor:n["--tertiary"],lineColor:n["--darkgray"],secondaryColor:n["--secondary"],tertiaryColor:n["--tertiary"],clusterBkg:n["--light"],edgeLabelBackground:n["--highlight"]}}),await r.run({nodes:e})}await o(),document.addEventListener("themechange",o),window.addCleanup(()=>document.removeEventListener("themechange",o));for(let n=0;n<e.length;n++){let v=function(){let g=l.querySelector("#mermaid-space"),m=l.querySelector(".mermaid-content");if(!m)return;y(m);let w=c.querySelector("svg").cloneNode(!0);m.appendChild(w),l.classList.add("active"),g.style.cursor="grab",u=new h(g,m)},M=function(){l.classList.remove("active"),u?.cleanup(),u=null},c=e[n],s=c.parentElement,a=s.querySelector(".clipboard-button"),d=s.querySelector(".expand-button"),p=window.getComputedStyle(a),L=a.offsetWidth+parseFloat(p.marginLeft||"0")+parseFloat(p.marginRight||"0");d.style.right=`calc(${L}px + 0.3rem)`,s.prepend(d);let l=s.querySelector("#mermaid-container");if(!l)return;let u=null;d.addEventListener("click",v),f(l,M),window.addCleanup(()=>{u?.cleanup(),d.removeEventListener("click",v)})}});
</script><script type="application/javascript">
        const socket = new WebSocket('ws://localhost:3001')
        // reload(true) ensures resources like images and scripts are fetched again in firefox
        socket.addEventListener('message', () => document.location.reload(true))
      </script><script src="../../postscript.js" type="module"></script></html>